2001-08-13  Ahmon Dancy  <dancy@dancy>

	*  loadem.cl: parameterized the create-service function..  Added
	delete-service function.

	* readme.txt:  Added building instructions and additional notes.

2001-08-11    <Ahmon Dancy@GOBY>

	* nfs.cl: Added comment to *statcachereaptime* to indicate that it
	should be larger than *openfilereaptime*.  

	Added code to return an IO error for the symlink call.

	Made some stat slot accessor macro.  

	Removed some unused functions.

	Modernized the fsinfo handler.

	Updated the open file reaper so that it resets the file
	modification time on the file after closing it (since closing may
	update the modification time to a value we don't want).

	* util.cl:

	Added set-file-time function to adjust the modification/access
	time of a file. 

	* util.cl:  Added truncate-file function which uses foreign functions.  
	* removed extra.c, extra.cl, and Makefile.  No more C code.

2001-08-10    <layer@HOBART>

	* portmap.cl (portmap-callit): add declare to get rid of compiler
	warning
	* loadem.cl: load ntservice from ntservice/

2001-08-10  Kevin Layer  <layer@crikey>

	* nfs.cl: lower dircachereaptime; work around strange problem with
	spot's nfs (copying from spot to hobart); some debugging info

2001-08-10    <dancy@DANCY2K>

	* sunrpc.cl:  Added new function rpc-send-prog-mismatch to send
	PROG_MISMATCH RPC responses.

	* loadem.cl:  Many changes.  Mostly to support the use of the nfs
	server as an NT service.   Requires "service.fasl".

	The new way to build the program:
	:cl loadem
	(loadem)
	(main)  ;; changed from (startem)

	Moved config file reading into this file (out of nfs.cl).

	Added function (create-service) which will add the nfs server to
	the list of services in Windows.  Make sure you call (buildit) to
	build a standalone executable.   

	* mountd.cl:  Changed the formatting of some debugging output.  

	The default list of exports is now nil.

	* nfs.cl:  Now check for incorrect NFS version request and send
	back a PROG_MISMATCH RPC reply.

	* portmap.cl:  Don't use the program version when matching.  This
	is gross.. but it makes things work better with amd (but I'm
	trying to convince the maintainer of am-utils that there is a bug
	in amd).
	

2001-08-03    <dancy@DANCY2K>

	* loadem.cl: Added a (buildit) function to build an nfs
	executable.  Added a (main) function.

	* nfs.cl:  Minor change that turned out to be unnecessary
	regarding the initialization of *nfsdxdr*.

2001-07-11    <dancy@SUCK>

	* nfs.cl (nfsd-statfs):  Added check for stale file handle.

2001-07-04    <dancy@DANCYSOFT>

	* fhandle.cl: Added function swap-fhandles which is used by the
	rename code.

	* nfs.cl: Added #+(version> 6 1) near calls to
	(set-socket-options) so that this code will continue to work in a
	6.0 Allegro CL.

	Removed a bunch of obsolete diropargs stuff.

	Try to catch bad pathnames earlier by adding check to
	add-filename-to-dirname.    Also changed a bunch of code that
	calls add-filename-to-dirname to check its result.

	Fixed nfsd-rename code.

2001-07-03    <dancy@SUCK>

	* nfs.cl: Moved some defparameters closer to the top of the file.
	Set the directory cache reap time parameter to 30 seconds.  This
	should help w/ 'rm -r' behavior.  Added a new parameter
	*socketbuffersize* which is used when creating the udp and tcp
	communications sockets.  It looks like the default receive buffer
	size for UDP packets was pretty small (somewhere around 8KB) so
	writes from high-performance operating systems such as Solaris
	would cause a lot of packets to be dropped... resulting in very
	slow performance.  

	Undo the addition of '.' and '..' to directories.  It doesn't
	appear to be necessary and it may have been causing problems.

	(add-direntries): Added error handler to handle weird directories
	like "c:\System Volume Information" on Windows 2000.  Also
	added/changed some debugging output.

	* sunrpc.cl: Added an error handler around
	mp:wait-for-input-available.  Apparently errors will occur here if
	a socket in the waitlist gets a connection refused message.  This
	new code will handle that situation.   

	Added (ignore-errors) around write-sequence and send-to calls.  If
	they fail, the client will try.

2001-07-02    <dancy@SUCK>

	* nfs.cl: Lowered *statcachereaptime* from 50000 to 5.  The 50000
	was for testing.   

	* portmap.cl:  Changed the main 'cond' into a 'case'.  Implemented
	portmpap-null.  Added portmap-callit.  It doesn't do
	anything... just prints out the parameters.   As far as I can
	tell, there is no reason to implement this right now.

	* sunrpc.cl:  Added a parameter *gather* that chooses between two
	behaviors when it comes to TCP traffic.  If *gather* is t, the
	packet size plus the packet data will be combined into a single
	buffer and sent all at once.  This requires copying the the packet
	data into a new buffer which may prove to be slow.  A potential
	advantage of this is that network overhead will be reduced since
	one packet will be sent instead of one small packet (4 bytes)
	followed by a larger one.  One definite advantage of this is that
	it allows packet analyzers (like tcpdump) to read the packet
	properly. 

	* xdr.cl:  Important bug fix in xdr-opaque-variable-from-stream.
	Opaque data is supposed to be blocked to a 4-byte boundary.  I
	wasn't doing that.  Non-linux clients got very upset by this.

2001-06-22    <dancy@SUCK>

	* nfs.cl: Use excl::filesys-delete-file instead of delete-file so
	that I can get errno information.

2001-06-20    <dancy@SUCK>

	* fhandle.cl: Removed the ensure-* functions.  Removed any unused
	functions.  Added some type declarations to possibly speed some
	operations up.  Changed one function to a macro.

	* mountd.cl: Updated the code to use with-successful-reply.
	Removed some calls to obsolete functions in fhandle.cl.

	* mpsocketfix.cl: Added #-(version>= 6 1) conditionals since this
	fix is in 6.1.

	* nfs.cl: Added some type declarations.  Added a check or two to
	make sure certain functions were being called w/ pathnames (not
	strings).  Removed some calls to obsolete functions in fhandle.cl.
	Removed some unused functions.

	* sunrpc.cl: Added a #-(version>= 6 1) conditional around the code
	that caused the EWOULDBLOCK in 6.0.

	* xdr.cl: Added a gang of type declarations.  Fixed the syntax
	error I had in defstruct that was making my attempts at type
	declarations useless.

	
2001-06-14    <dancy@SUCK>

	* nfs.cl: Remove extra debugging output.  Added extra error
	checking to nfsd-create.

	* loadem.cl: Added 'fixes' to the load/compile list.

	* nfs.cl: Zillions of changes for optimization.  Added in a
	blocksize hack to improve 'rm -r' behavior w/ linux clients.

	* xdr.cl: removed a debugging message..  did some minor
	optimizations.

2001-06-07    <dancy@SUCK>


	* nfs.cl: Changed a zillion calls from ff:fslot-value to
	ff:fslot-value-typed.  Added a function to update file mtime,
	atime, and filesize in the statcache (used for nfsd-write).
	Cleaned up nfsd-remove.  Cleaned up nfsd-write.  

	* xdr.cl:  Changed the way xdr-opaque-fixed/variable return things
	(during extraction).
	
	* mountd.cl (mountd-make-fhstatus): Specify the size of the xdr to
	speed things up.

	* loadem.cl (startem): Run (nfsd) as a separate process now.

	* fhandle.cl (opaque-fhandle-to-pathname): New function.  
	* Many many changes that hopefully will improve performance

2001-05-23    <dancy@SUCK>

	* nfs.cl:  nfsd-getattr:  Added check for stale file handle.
	Commented out some debugging lines.

	nfsd-read: Changed call to xdr-opaque-variable to be more
	efficient (no subseq).

	* xdr.cl: Changed xdr-opaque-variable to allow for efficient
	operation.   Added a function xdr-opaque-variable-from-stream
	which isn't used yet.

2001-05-23    <layer@HOBART>

	* nfs.cl (nfsd-write): handle case of fhandle-vec-to-pathname
	returning nil

2001-05-23    <dancy@SUCK>

	* nfs.cl:  Changed a debugging message

	* sunrpc.cl: Update send-successful-reply so that it doesn't call
	rpc-send-msg (which saves an xdr-xdr call).

	* xdr.cl: Added a 'pos' slot to the xdr structure to use to avoid
	subseq calls in xdr-advance.  Updated other code to use this new
	slot.  Probably introduced a buncha bugs.

2001-05-23    <layer@HOBART>

	* extra.cl: make warning go away
	* nfs.cl: fix nfsd-remove to handle permission denied

2001-05-23  Kevin Layer  <layer@crikey>

	* many files, CRLF conversion

2001-05-22    <dancy@DANCYSOFT>

	* fhandle.cl:  Make sure pathnames are always canonicalized before
	hashing.  Also, added a function for dumping the file handle hash
	table.

	* mountd.cl: added (in-package :user) and $Id: ChangeLog,v 1.26 2001/08/13 17:09:55 dancy Exp $

	* mpsocketfix.cl: added (in-package :user) and $Id: ChangeLog,v 1.26 2001/08/13 17:09:55 dancy Exp $

	* nfs.cl added (in-package :user) and $Id: ChangeLog,v 1.26 2001/08/13 17:09:55 dancy Exp $
	Added a function to make sure directory names end w/ a backslash.

	Increased debugging info for nfs-readdir.

	Removed readdir caching code.

	Increased debugging info for add-direntries and also attempted to
	add a workaround for what I believe is a bug in the Linux NFS v2
	client implementation w/ regard to readdir.

	* portmap.cl:  added (in-package :user) and $Id: ChangeLog,v 1.26 2001/08/13 17:09:55 dancy Exp $

	* sunrpc.cl: added (in-package :user) and $Id: ChangeLog,v 1.26 2001/08/13 17:09:55 dancy Exp $

	* utils.cl: added (in-package :user) and $Id: ChangeLog,v 1.26 2001/08/13 17:09:55 dancy Exp $
	added :strings-convert nil  to calls to def-foreign-call to remove
	warnings. 

	* xdr.cl: added (in-package :user) and $Id: ChangeLog,v 1.26 2001/08/13 17:09:55 dancy Exp $

	* nfs.cl: Send rpc PROC_UNAVAIL for procedures that we don't
	handle.  This will prevent nfs clients from wedging.

	* sunrpc.cl: Added rpc-send-proc-unavail function to send
	PROC_UNAVAIL responses.

	* Added .cvsignore

	* added nfs.txt which is the NFS V2 RFC.

	* Updated the readme to show how to edit the export list

	* Updated extra.c to only defined INVALID_SET_FILE_POINTER if it
	isn't already defined.

	* Added Makefile and ChangeLog
	

